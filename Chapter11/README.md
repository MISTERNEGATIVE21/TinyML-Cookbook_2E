<h2>Chapter 11</h2>
<h1><b>Running ML models on the Arduino and Arm Ethos-U55 microNPU using Apache TVM </b></h1>

<h2> About this chapter </h2>

In this chapter, we will explore how to leverage <b>Apache TVM</b> to deploy a quantized CIFAR-10 TensorFlow Lite model in various scenarios.
The chapter will start by giving an overview of <b>Arduino Command Line Interface (CLI)</b>, the indispensable tool to compile and run the code generated by TVM on any Arduino compatible platform.
After introducing Arduino CLI, we will present TVM by showing how to generate C code from an ML and how to run it on the machine hosting the Colab environment. In this part, we will also discuss the <b>ahead-of-time (AoT)</b> executor, a crucial feature of TVM that can help reduce the program memory usage of the final application.
Then, we will delve into running the model on the Arduino Nano and Raspberry Pi Pico and discuss how to build and compile a sketch from the code generated by TVM
Finally, we will explore the model deployment on a new, advanced processor designed to extend the computational power and energy efficiency of ML workloads on microcontrollers. This processor is the <b>Micro-Neural Processing Unit (microNPU)</b> that promises to unlock new use cases and make the "things" around us even more intelligent.

<h2> Devices </h2>

| Arduino Nano 33 BLE Sense (Rev1 and Rev2) | Raspberry Pi Pico | SparkFun RedBoard Artemis Nano |Software emulated device |
| ----------- | ---------------------------------------------------------------- | -- | -- |
| ✅ | ✅ | ✅ | ✅ |

<h2> Hardware components </h2>

| Sensor  | Breadboard | Jumper wires | LEDs | Resistors | Extra |
| --------| -----------| ------------ | ---- | --------- | ----- |
| - | - | - | - | - | - |

<h2> Software (SW) Environments </h2>

| ML | Embedded programming |
| --------| -------------------- |
| Google Colaboratory | Arduino IDE (or Arduino Web Editor) |

<h2> Source code </h2>

<table class="fixed">
    <col width=50%/>
<tr>
    <th>Recipe</th>
    <th>Source code</th>
    <th>There's more</th>
</tr>
<tr style="height:72px">
    <td>Getting familiar with Arduino CLI</td>
    <td>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ArduinoSketches/01_blink_led.ino">
        <img title="Arduino sketch" src="../Imgs/arduino_sketch_icon.png" width="40">
        </a>
    </td>
    <td>
        <a>
        <img title="More in the book!" src="../Imgs/books_icon.svg" width="40">
        </a>
    </td>
</tr>
<tr style="height:72px">
    <td>Downloading the pre-trained CIFAR-10 model and input test image</td>
    <td>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ColabNotebooks/tvm.ipynb">
        <img title="Colab notebook" src="../Imgs/colab_icon.png" width="40">
        </a>
    </td>
    <td>
        <a>
        <img title="More in the book!" src="../Imgs/books_icon.svg" width="40">
        </a>
    </td>
</tr>
<tr style="height:72px">
    <td>Deploying the model with TVM using the ahead-of-time executor on the host machine</td>
    <td>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ColabNotebooks/tvm.ipynb">
        <img title="Colab notebook" src="../Imgs/colab_icon.png" width="40">
        </a>
    </td>
    <td>
        <a>
        <img title="More in the book!" src="../Imgs/books_icon.svg" width="40">
        </a>
    </td>
</tr>
<tr style="height:72px">
    <td>Deploying the model on the Arduino Nano</td>
    <td>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ColabNotebooks/tvm.ipynb">
        <img title="Colab notebook" src="../Imgs/colab_icon.png" width="40">
        </a>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ArduinoSketches/04_micro_tvm.ino">
        <img title="Arduino sketch" src="../Imgs/arduino_sketch_icon.png" width="40">
        </a>
    </td>
    <td>
        <a>
        <img title="More in the book!" src="../Imgs/books_icon.svg" width="40">
        </a>
    </td>
</tr>
<tr style="height:72px">
    <td>Deploying the model on the Raspberry Pi Pico</td>
    <td>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ColabNotebooks/tvm.ipynb">
        <img title="Colab notebook" src="../Imgs/colab_icon.png" width="40">
        </a>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ArduinoSketches/04_micro_tvm.ino">
        <img title="Arduino sketch" src="../Imgs/arduino_sketch_icon.png" width="40">
        </a>
    </td>
    <td>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ColabNotebooks/tvm.ipynb">
        <img title="Colab notebook" src="../Imgs/colab_icon.png" width="40">
        </a>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ArduinoSketches/04_micro_tvm.ino">
        <img title="Arduino sketch" src="../Imgs/arduino_sketch_icon.png" width="40">
        </a>
    </td>
</tr>
<tr style="height:72px">
    <td>Installing the Fixed Virtual Platform for the Arm Corstone-300</td>
    <td>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ColabNotebooks/tvm.ipynb">
        <img title="Colab notebook" src="../Imgs/colab_icon.png" width="40">
        </a>
    </td>
    <td>
        <a>
        <img title="More in the book!" src="../Imgs/books_icon.svg" width="40">
        </a>
    </td>
</tr>
<tr style="height:72px">
    <td>Code generation with TVMC for Arm Ethos-U55</td>
    <td>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ColabNotebooks/tvm.ipynb">
        <img title="Colab notebook" src="../Imgs/colab_icon.png" width="40">
        </a>
    </td>
    <td>
        <a>
        <img title="More in the book!" src="../Imgs/books_icon.svg" width="40">
        </a>
    </td>
</tr>
<tr style="height:72px">
    <td>Installing the software dependencies for building an application for the Arm Ethos-U microNPU</td>
    <td>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ColabNotebooks/tvm.ipynb">
        <img title="Colab notebook" src="../Imgs/colab_icon.png" width="40">
        </a>
    </td>
    <td>
        <a>
        <img title="More in the book!" src="../Imgs/books_icon.svg" width="40">
        </a>
    </td>
</tr>
<tr style="height:72px">
    <td>Running the CIFAR-10 model inference on the Arm Ethos-U55 microNPU</td>
    <td>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/ColabNotebooks/tvm.ipynb">
        <img title="Colab notebook" src="../Imgs/colab_icon.png" width="40">
        </a>
        <a href="https://github.com/PacktPublishing/TinyML-Cookbook_2E/blob/main/Chapter11/TVMEthosUProject/09_cifar10_demo.c">
        <img title="C/C++ code" src="../Imgs/code_icon.png" width="40">
        </a>
    </td>
    <td>
        <a>
        <img title="More in the book!" src="../Imgs/books_icon.svg" width="40">
        </a>
    </td>
</tr>
</table>
